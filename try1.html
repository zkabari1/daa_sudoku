<html>
<head>
<style type="text/css">
	  #header { background-color: #FFFFCC; color: black; border: solid 1px black; font-family: "Sans Serif","Verdana"; padding:1em 1em 0em 1em;}
	  #header h1 { margin-top: 0px;}
	  #header a:visited,a:active,a { text-decoration: none; color: blue; }
	  #header a:hover { text-decoration: none; color: red; }
	  .infobox { display: none; padding-bottom:1em; font-size:9pt; padding-left: 1em;}
	  #board { float: left; border: solid 2px black; padding: 1em 1em 1em 1em; margin-right: 20px; margin-top: 20px; margin-bottom: 60px;}
	  #controls { padding-top: 1em;}
	  #controls table { border: solid 1px black; }
	  #controls td	{ text-align: center; }
	  .tablecol { border: solid 1px black; padding-left: 5px; padding-right: 5px;}
		.bigbutton { width:200px; height: 50px; font-size: 15pt;}
		h1 { margin-bottom: 0px;}
		.hspacer { padding-right: 10px;}
		#status { height: 25px;}
		#difficulty { font-size: 24pt; font-weight: bold; color: blue; margin-top: 0px; padding-top: 0px;}
		#board input	{ width: 40px; height: 40px; border: 2px solid gray; font-size: 24pt; font-family: Verdana, Arial; text-align: center; padding: 0em 0em 0em 0em; }		
		.graybox { background-color: gray; }
	</style>
<script>
var input_board = new Array(81);
var constraints = new Array(81);
var ratedDiff = false;
for(var x = 0; x < 81; x++)	
	constraints[x] = new Array(10);
var blockDef = new Array(9);
blockDef[0] = [0,1,2,9,10,11,18,19,20];
blockDef[1] = [3,4,5,12,13,14,21,22,23];
blockDef[2] = [6,7,8,15,16,17,24,25,26];
blockDef[3] = [27,28,29,36,37,38,45,46,47];
blockDef[4] = [30,31,32,39,40,41,48,49,50];
blockDef[5] = [33,34,35,42,43,44,51,52,53];
blockDef[6] = [54,55,56,63,64,65,72,73,74];
blockDef[7] = [57,58,59,66,67,68,75,76,77];
blockDef[8] = [60,61,62,69,70,71,78,79,80];
var testcase = new Array();
var cOrder = new Array(81);
testcase[4] = new Array(81);
testcase[4] = [0,0,0,0,0,1,0,2,0,3,0,0,0,4,0,5,0,0,0,0,0,6,0,0,0,0,7,0,0,2,0,0,0,0,0,6,0,5,0,0,3,0,0,8,0,4,0,0,0,0,0,9,0,0,9,0,0,0,0,2,0,0,0,0,8,0,0,5,0,4,0,0,0,0,1,7,0,0,0,0,0 ];
function highlight(r, c)	{
  document.getElementById("box"+r+"-"+c).style.background = "red";
  var expr = "document.getElementById('box"+r+"-"+c+"').style.background = 'white';";
  setTimeout(expr, 1500);
}
function fillIn(pos, till)	{
	for(var x = 0; x < till; x++)	{
		var r = Math.floor(x / 9);
		var c = x % 9;
		if(pos[x] == 0)
			document.getElementById("box"+r+"-"+c).value = "";
		else
			document.getElementById("box"+r+"-"+c).value = pos[x];
	}
}
function getBoard()	{
	var x;
	for(var r = 0; r < 9; r++)
		for(var c = 0; c < 9; c++)	{
      		x = document.getElementById("box"+r+"-"+c).value;
			if(x == '' || x == ' ') 
				x = 0;
			if(!(x>=0 && x <= 9))	{
				highlight(r, c);
				status("<b>Invalid entry '"+x+"' in board!</b>");
				return false;
			}
			board[r*9+c] = Number(x);
			input_board[r*9+c] = Number(x);
		}		
	return true;
}
function updateConstraints(pos)	{
	console.log(pos);
	var solved = 0;
	var sum = 0;
	var num = 0;

	for(var p = 0; p < 81; p++)	{
		for(var x = 0; x < 10; x++)
			constraints[p][x] = 0;
			
		if(pos[p] >= 1 && pos[p] <= 9)	{
		  	/* filled cell, no constraints */
			constraints[p][0] = 1;
			constraints[p][pos[p]] = 1;
		}
		else	{
			/* blank square, find possible values */
			var r = Math.floor(p / 9);
			var c = p % 9;
			for(var x = 1; x <= 9; x++)
				constraints[p][x] = 1;
			/* get row constraints */
			for(var x = 0; x < 9; x++)
				if(pos[r * 9 + x] > 0)
					constraints[p][Number(pos[r*9+x])] = 0;
			/* get column constraints */
			for(var x = 0; x < 9; x++)
				if(pos[x * 9 + c] > 0)
					constraints[p][Number(pos[x*9+c])] = 0;
			/* get block constraints */
			var block = Math.floor(r/3)*3 + Math.floor(c/3);
			for(var x = 0; x < 9; x++)
			  if(pos[blockDef[block][x]] > 0)
			    constraints[p][Number(pos[blockDef[block][x]])] = 0;
			
			/* update constraints */
			var last_valid = -1;
			for(var x = 1; x <= 9; x++)
				if(constraints[p][x] == 1) 	{
					constraints[p][0]++;
					last_valid = x;
				}
				
			if(constraints[p][0] == 1)	{
			  	pos[p] = last_valid;
				document.getElementById("box"+r+"-"+c).value = pos[p];
				highlight(r, c);
				solved++;
			}
			if(constraints[p][0] == 0)	{
				status("Highlighted cell has no possible value, board has no solution.");
				highlight(r, c);
				abort=true;
				return -1;
			}
		}

		if(constraints[p][0] > 0)	{		
			sum += constraints[p][0];
			num++;
		}
	}		
	
	if(!ratedDiff)	{
		var estDiff = (num==0||sum==0)?0:num*Math.log(sum*1.0/num);
		estDiff = Math.round(estDiff*100)/100;
		ratedDiff = true;
	}		
	
	return solved;
}
function solveme()	{
	console.log("Solving...");
	ratedDiff = false;
	if(!getBoard())
		return;
	/* Phase 1: Constraint reduction (should solve all "easy" instances) */
	console.log("Phase 1: Iterative constraint reduction...");
	var x;
	do {
		x = updateConstraints(board);
		if(x == -1)	{
			abort=true;
			enableButtons();
			return;
		}
	} while(x > 0);
	
	/* Phase 2: Search (for the harder ones with multiple choices per cell */	
	search_dfs();
}
function search_dfs()	{
	/* Phase 2: Search */
	console.log("Phase 2: Search");
	reorder_constraints();
	//order_constraints();
	initialize_dfs();
	search_r();
}
var iters_per_timeslice = 4000;
function validate()	{
	var x = cOrder[search_pos];
	var cur_r = Math.floor(x/9);
	var cur_c = x%9;
	var cur_b = Math.floor(cur_r/3)*3 + Math.floor(cur_c/3);

	for(var m = 0; m < search_pos; m++)	{
		var p = cOrder[m];
		var r = Math.floor(p / 9);
		var c = p % 9;
		var b = Math.floor(r/3)*3 + Math.floor(c/3);
		if( (r == cur_r || c == cur_c || b == cur_b) && cpointers[p] == cpointers[x])	
			return false;	
	}
	return true;
}

function search_r()	{
  	var iter = 0;
 
  	while(iter++ < iters_per_timeslice)	{
  		
  		if(search_pos >= cOrder.length)	{
  			/* Solved */
		  	for(var p = 0; p < cOrder.length; p++)	{
		  		var cons = cOrder[p];
		  		var r = Math.floor(cons/9);
		  		var c = cons%9;
		  		document.getElementById("box"+r+"-"+c).value = cpointers[cons];
		  	}
  			var d = new Date();
  			var secs = (d.getTime() - start_time)/1000;
  			status("Board solved.<br>Time: <b>"+secs+"s");
			enableButtons();
			abort=true;
  			return;
  		}
  	
		var cons = cOrder[search_pos];
		
		/* find an allowable number for this cell */
		while(++cpointers[cons] < 10)	
			if(constraints[cons][cpointers[cons]] == 1 && validate())	
				break;
			
		if(cpointers[cons] >= 10)	{
			cpointers[cons] = 0;
			search_pos--;
			continue;
		} 
		
		search_pos++;  
  	}  
  	
  	/* display progress */
  	for(var p = 0; p < cOrder.length; p++)	{
  		var cons = cOrder[p];
  		var r = Math.floor(cons/9);
  		var c = cons%9;
  		document.getElementById("box"+r+"-"+c).value = p<search_pos?cpointers[cons]:" ";
  	}

	/* randomize order of remaining constraints */
	if(randomize && timeslices % 50 == 0)
		randomize_constraints_from(search_pos);
  	
  	timeslices++;
  	console.log("Phase 2: Search.<br><b>Timeslices:</b> "+timeslices);
  	setTimeout("search_r()", sleep_timeslice);
}
var sleep_timeslice = 200;
var randomize = false;
var timeslices = 0;
var cpointers = new Array(81);
function initialize_dfs()	{
	for(var x = 0; x < 81; x++)
		cpointers[x] = 0;
	search_pos = 0;
}
function reorder_constraints()	{
	var fewest_constraints = 11;
	var fewest = -1;
	cOrder.length = 0;

	/* find a cell with the fewest constraints */
	for(var p = 0; p < 81; p++)
		if(constraints[p][0] > 1 && constraints[p][0] < fewest_constraints)	{
			fewest = p;
			fewest_constraints = constraints[p][0];
		}
	if(fewest == -1)
		return;
	cOrder.push(fewest);
	
	/* add all constraints along fewest's row and column and block */
	var r = Math.floor(fewest / 9);
	var c = fewest % 9;
	var b = Math.floor(r/3)*3 + Math.floor(c/3);
	for(var x = 0; x < 9; x++)
		if(x*9+c != fewest && constraints[x*9+c][0] > 1)
			cOrder.push(x*9+c);
	for(var x = 0; x < 9; x++)
		if(r*9+x != fewest && constraints[r*9+x][0] > 1)
			cOrder.push(r*9+x);
	for(var x = 0; x < 9; x++)	{
		var r_2 = Math.floor(blockDef[b][x]/9);
		var c_2 = blockDef[b][x] % 9;
		if(r_2 == r || c_2 == c || constraints[blockDef[b][x]][0] < 2)
			continue;
		cOrder.push(blockDef[b][x]);	
	}
	
	/* add all the remaining constraints */
	for(var x = 0; x < 81; x++)	{
		if(constraints[x][0] < 2)
			continue;
		var r_2 = Math.floor(x/ 9);
		var c_2 = x% 9;
		var b_2 = Math.floor(r_2/3)*3 + Math.floor(c_2/3);
		if(r_2 == r || c_2 == c || b_2 == b)
			continue;
		cOrder.push(x);	
	}
}

</script>
</head>
<body>
	<div id="board">
			<input id="box0-0" maxlength="1">
			<input id="box0-1" maxlength="1">
			<input id="box0-2" maxlength="1"> <span class="hspacer"> </span>
			<input id="box0-3" maxlength="1">
			<input id="box0-4" maxlength="1">
			<input id="box0-5" maxlength="1"> <span class="hspacer"> </span>
			<input id="box0-6" maxlength="1">
			<input id="box0-7" maxlength="1">
			<input id="box0-8" maxlength="1">
			<br>
			<input id="box1-0" maxlength="1">
			<input id="box1-1" maxlength="1">
			<input id="box1-2" maxlength="1"> <span class="hspacer"> </span>
			<input id="box1-3" maxlength="1"> 
			<input id="box1-4" maxlength="1">
			<input id="box1-5" maxlength="1"> <span class="hspacer"> </span>
			<input id="box1-6" maxlength="1"> 
			<input id="box1-7" maxlength="1">
			<input id="box1-8" maxlength="1">
			<br>
			<input id="box2-0" maxlength="1">
			<input id="box2-1" maxlength="1">
			<input id="box2-2" maxlength="1"> <span class="hspacer"> </span>
			<input id="box2-3" maxlength="1">
			<input id="box2-4" maxlength="1">
			<input id="box2-5" maxlength="1"> <span class="hspacer"> </span>
			<input id="box2-6" maxlength="1">
			<input id="box2-7" maxlength="1">
			<input id="box2-8" maxlength="1">
			<br> <hr>
			<input id="box3-0" maxlength="1">
			<input id="box3-1" maxlength="1">
			<input id="box3-2" maxlength="1"> <span class="hspacer"> </span>
			<input id="box3-3" maxlength="1">
			<input id="box3-4" maxlength="1">
			<input id="box3-5" maxlength="1"> <span class="hspacer"> </span>
			<input id="box3-6" maxlength="1">
			<input id="box3-7" maxlength="1">
			<input id="box3-8" maxlength="1">
			<br> 
			<input id="box4-0" maxlength="1">
			<input id="box4-1" maxlength="1">
			<input id="box4-2" maxlength="1"> <span class="hspacer"> </span>
			<input id="box4-3" maxlength="1">
			<input id="box4-4" maxlength="1">
			<input id="box4-5" maxlength="1"> <span class="hspacer"> </span>
			<input id="box4-6" maxlength="1">
			<input id="box4-7" maxlength="1">
			<input id="box4-8" maxlength="1">
			<br>
			<input id="box5-0" maxlength="1">
			<input id="box5-1" maxlength="1">
			<input id="box5-2" maxlength="1"> <span class="hspacer"> </span>
			<input id="box5-3" maxlength="1">
			<input id="box5-4" maxlength="1">
			<input id="box5-5" maxlength="1"> <span class="hspacer"> </span>
			<input id="box5-6" maxlength="1">
			<input id="box5-7" maxlength="1">
			<input id="box5-8" maxlength="1">
			<br> <hr>
			<input id="box6-0" maxlength="1">
			<input id="box6-1" maxlength="1">
			<input id="box6-2" maxlength="1"> <span class="hspacer"> </span>
			<input id="box6-3" maxlength="1">
			<input id="box6-4" maxlength="1">
			<input id="box6-5" maxlength="1"> <span class="hspacer"> </span>
			<input id="box6-6" maxlength="1">
			<input id="box6-7" maxlength="1">
			<input id="box6-8" maxlength="1">
			<br> 
			<input id="box7-0" maxlength="1">
			<input id="box7-1" maxlength="1">
			<input id="box7-2" maxlength="1"> <span class="hspacer"> </span>
			<input id="box7-3" maxlength="1">
			<input id="box7-4" maxlength="1">
			<input id="box7-5" maxlength="1"> <span class="hspacer"> </span>
			<input id="box7-6" maxlength="1">
			<input id="box7-7" maxlength="1">
			<input id="box7-8" maxlength="1">
			<br>
			<input id="box8-0" maxlength="1">
			<input id="box8-1" maxlength="1">
			<input id="box8-2" maxlength="1"> <span class="hspacer"> </span>
			<input id="box8-3" maxlength="1">
			<input id="box8-4" maxlength="1">
			<input id="box8-5" maxlength="1"> <span class="hspacer"> </span>
			<input id="box8-6" maxlength="1">
			<input id="box8-7" maxlength="1">
			<input id="box8-8" maxlength="1">
	</div>
	<button id="bsolveme" onclick="solveme()" class="bigbutton"><b>Solve</b></button>
	<button id="btc1" onclick="fillIn(testcase[4], 81)">Easy</button>
	
</body>