<html>
<head>
	<link rel="stylesheet" href="style.css">
</head>
<body onload="creategrid()">

<div class="split left">
	<h1 class="text">Sudoku</h1>
	<h4 class="text">Hours of brain challenging fun</h4><br>
	<div class="text">
		<h4> Grid: 
			<select onchange="creategrid()" id="grid">
				<option value="4" >4x4</option>
				<option value="6">6x6</option>
				<option value="9">9x9</option>
				<option value="16" selected="selected">16x16</option>
			</select>
		</h4>
		
		<h4> Level: 
			<input type="radio" name="lvl" value="easy" checked="checked" onclick="creategrid()"> Easy
			<input type="radio" name="lvl" value="med" onclick="creategrid()"> Medium
			<input type="radio" name="lvl" value="hard" onclick="creategrid()"> Hard
		</h4>
		
		<div id="btns" >
		<button type="button" class="button">Hint</button>
		<button type="button" class="button">Check</button>
		<button type="button" class="button" onclick="creategrid()">Reset</button><br><br>
		<button type="button" class="button" onclick="solution()">See Solution</button><br><br>
		<button type="button" class="button" onclick="emptygrid()">Create Your Own Grid</button>
		</div>
		
	</div>
</div>

<div class="split right" >
	<div class="centered" id="right">
	</div>
	
</div>

<script type="text/javascript">
document.getElementById("grid").onchange = function() {creategrid()};
document.getElementsByName("lvl").onchange = function() {creategrid()};

let iters_per_timeslice = 8000;
let sleep_timeslice = 1;
let randomize = false;
let timeslices = 0;

//letiables for 16x16
let constraints16 = new Array(256);
for(let x = 0; x < 256; x++)	
	constraints16[x] = new Array(17);
let blockDef16 = new Array(16);
blockDef16[0]=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15];
blockDef16[1]=[16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31];
blockDef16[2]=[32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47];
blockDef16[3]=[48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63];
blockDef16[4]=[64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79];
blockDef16[5]=[80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95];
blockDef16[6]=[96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111];
blockDef16[7]=[112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127];
blockDef16[8]=[128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143];
blockDef16[9]=[144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159];
blockDef16[10]=[160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175];
blockDef16[11]=[176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191];
blockDef16[12]=[192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207];
blockDef16[13]=[208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223];
blockDef16[14]=[224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239];
blockDef16[15]=[240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255];

let cOrder16 = new Array(256);
let cpointers16 = new Array(256);

function creategrid() {
	document.getElementById("right").innerHTML = "";
	let count=document.getElementById('grid').value;
	let level=document.querySelector('input[name=lvl]:checked').value;
	let body = document.getElementById("right");
		let tbl = document.createElement("table");
		tbl.setAttribute("id",'A'+count);
	  	let tblBody = document.createElement("tbody");
	  	for (let i = 0; i < count; i++) {
	    	let row = document.createElement("tr");
	    	for (let j = 0; j < count; j++) {
				let cell = document.createElement("td");
				cell.setAttribute("contenteditable","true");
	      		let cellText = document.createTextNode('');
	      		cell.appendChild(cellText);
				row.appendChild(cell);
	    	}
	    	tblBody.appendChild(row);
	  	}tbl.appendChild(tblBody);
	  	body.appendChild(tbl);
	
	if(count==4){
		if(level === "easy"){
		let easy = new Array(['','','','3'],['3','2','4',''],['','4','3','2'],['2','','','']);
			for(let i=0;i<count;i++){
				for(let j=0;j<count;j++){
					if(easy[i][j]!== ''){
						tbl.rows[i].cells[j].innerHTML=easy[i][j];
					}
					else{
						tbl.rows[i].cells[j].setAttribute("data-sol","1");
					}
				}
			}
		}
		else if(level === "med"){
		let easy = new Array(['3','','',''],['','1','3',''],['','4','2',''],['','','','4']);
			for(let i=0;i<count;i++){
				for(let j=0;j<count;j++){
					if(easy[i][j]!== ''){
						tbl.rows[i].cells[j].innerHTML=easy[i][j];
					}
					else{
						tbl.rows[i].cells[j].setAttribute("data-sol","1");
					}
				}
			}
		}
		else{
		let easy = new Array(['1','','4',''],['','','',''],['','','',''],['','1','','2']);
			for(let i=0;i<count;i++){
				for(let j=0;j<count;j++){
					if(easy[i][j]!== ''){
						tbl.rows[i].cells[j].innerHTML=easy[i][j];
					}
					else{
						tbl.rows[i].cells[j].setAttribute("data-sol","1");
					}
				}
			}
		}
	}
	else if(count==6){
		if(level === "easy"){
		let easy = [0,0,0,0,5,2,2,0,5,0,6,0,1,0,0,0,0,0,4,6,2,3,0,5,0,4,0,0,3,0,0,2,0,0,4,1];
			for(let i=0,k=0;i<count;i++){
				for(let j=0;j<count;j++,k++){
					if(easy[k]!== 0){
						tbl.rows[i].cells[j].innerHTML=easy[k];
					}
					else{
						tbl.rows[i].cells[j].innerHTML="";
						tbl.rows[i].cells[j].setAttribute("data-sol","1");
					}
				}
			}
		}
		else if(level === "med"){
		let easy = new Array(['','5','','3','','2'],['','','','','',''],['1','','','','',''],['','2','','','5',''],['','1','','4','',''],['4','','','5','6','']);
			for(let i=0;i<count;i++){
				for(let j=0;j<count;j++){
					if(easy[i][j]!== ''){
						tbl.rows[i].cells[j].innerHTML=easy[i][j];
					}
					else{
						tbl.rows[i].cells[j].setAttribute("data-sol","1");
					}
				}
			}
		}
		else{
		let easy = new Array(['','','6','','',''],['4','','','','','1'],['','5','','','3','2'],['','','','','',''],['','3','2','5','',''],['','','','','','']);
			for(let i=0;i<count;i++){
				for(let j=0;j<count;j++){
					if(easy[i][j]!== ''){
						tbl.rows[i].cells[j].innerHTML=easy[i][j];
					}
					else{
						tbl.rows[i].cells[j].setAttribute("data-sol","1");
					}
				}
			}
		}
	}
	else if(count==9){
		if(level === "easy"){
		let easy = [5,0,9,1,0,0,6,4,2,0,4,1,0,5,0,0,8,0,6,7,0,2,0,4,0,9,5,1,0,0,8,0,3,0,5,9,8,9,4,5,6,0,3,7,1,0,0,5,4,1,0,2,6,8,3,0,8,7,4,0,0,0,0,0,0,0,6,0,5,8,3,4,4,0,6,3,9,8,5,1,0];
			for(let i=0,k=0;i<count;i++){
				for(let j=0;j<count;j++,k++){
					if(easy[k]!== 0){
						tbl.rows[i].cells[j].innerHTML=easy[k];
					}
					else{
						tbl.rows[i].cells[j].innerHTML="";
						tbl.rows[i].cells[j].setAttribute("data-sol","1");
					}
				}
			}
		}
		else if(level === "med"){
		let easy = [9,0,0,0,3,0,0,0,0,0,0,0,6,0,0,0,0,0,0,0,0,7,1,0,0,2,0,4,0,0,1,5,6,0,0,0,0,2,0,0,0,0,0,0,0,0,8,0,4,0,0,0,0,0,7,0,0,0,4,0,5,0,9,1,0,0,8,0,0,3,0,0,2,0,0,0,0,0,0,0,0];
			for(let i=0,k=0;i<count;i++){
				for(let j=0;j<count;j++,k++){
					if(easy[k]!== 0){
						tbl.rows[i].cells[j].innerHTML=easy[k];
					}
					else{
						tbl.rows[i].cells[j].innerHTML="";
						tbl.rows[i].cells[j].setAttribute("data-sol","1");
					}
				}
			}
		}
		else{
		let easy = [1,0,0,0,0,6,0,0,0,0,5,0,7,0,0,0,0,3,0,0,9,0,2,0,0,0,0,0,4,0,5,0,0,3,0,0,0,0,0,0,9,0,0,5,0,0,0,0,0,0,0,0,7,4,0,7,0,8,0,0,0,4,0,6,0,0,0,0,0,8,0,0,0,0,2,0,0,1,0,0,0];
			for(let i=0,k=0;i<count;i++){
				for(let j=0;j<count;j++,k++){
					if(easy[k]!== 0){
						tbl.rows[i].cells[j].innerHTML=easy[k];
					}
					else{
						tbl.rows[i].cells[j].innerHTML="";
						tbl.rows[i].cells[j].setAttribute("data-sol","1");
					}
				}
			}
		}
	}
	else{
		if(level === "easy"){
		let easy = [0,3,0,0,0,0,11,0,5,14,0,6,0,10,0,0,0,0,0,4,3,0,0,0,0,12,15,10,0,0,0,0,0,0,1,15,14,10,13,16,0,0,4,2,0,0,0,9,0,2,16,0,9,12,0,0,0,7,0,0,0,0,0,0,0,14,10,0,2,0,0,1,0,5,6,0,0,0,16,0,4,0,0,7,0,0,0,0,0,0,0,0,0,0,5,0,16,13,9,12,0,0,0,7,2,1,0,0,0,0,0,0,8,0,0,0,0,9,0,0,0,0,0,14,15,0,7,0,0,5,4,13,7,0,0,14,0,8,0,0,0,1,0,0,6,0,15,0,0,0,1,0,0,3,0,0,4,0,0,0,0,0,0,14,11,0,5,0,0,0,0,0,0,0,13,3,3,0,0,10,0,0,6,8,0,13,0,0,16,15,0,7,2,0,0,8,10,0,16,0,3,0,0,5,14,0,15,0,15,0,0,0,0,0,9,0,0,6,0,0,3,7,0,0,0,0,13,5,0,3,0,0,0,0,0,0,0,0,10,1,14,16,0,0,5,13,15,11,0,0,0,0,6,4,12,0];
			for(let i=0,k=0;i<count;i++){
				for(let j=0;j<count;j++,k++){
					if(easy[k]!== 0){
						tbl.rows[i].cells[j].innerHTML=easy[k];
					}
					else{
						tbl.rows[i].cells[j].innerHTML="";
						tbl.rows[i].cells[j].setAttribute("data-sol","1");
					}
				}
			}
		}
		else if(level === "med"){
		let easy = new Array(['3','','',''],['','1','3',''],['','4','2',''],['','','','4']);
			for(let i=0;i<count;i++){
				for(let j=0;j<count;j++){
					if(easy[i][j]!== ''){
						tbl.rows[i].cells[j].innerHTML=easy[i][j];
					}
					else{
						tbl.rows[i].cells[j].setAttribute("data-sol","1");
					}
				}
			}
		}
		else{
		let easy = new Array(['1','','4',''],['','','',''],['','','',''],['','1','','2']);
			for(let i=0;i<count;i++){
				for(let j=0;j<count;j++){
					if(easy[i][j]!== ''){
						tbl.rows[i].cells[j].innerHTML=easy[i][j];
					}
					else{
						tbl.rows[i].cells[j].setAttribute("data-sol","1");
					}
				}
			}
		}
	}	
}
function solving16(){
	console.log("Solving 16x16...");
	creategrid();
	let count=document.getElementById('grid').value;
	let body = document.getElementById("right");
	let tbl = body.getElementsByTagName("table")[0];
	let tblbody = tbl.getElementsByTagName("tbody")[0];
	let input=new Array(256);
	for(let i=0,k=0;i<count;i++){
	row = tblbody.getElementsByTagName("tr")[i];
		for(let j=0;j<count;j++,k++){
			col = row.getElementsByTagName("td")[j];
			cellvalue=col.childNodes[0];
			if(cellvalue!==undefined){
				input[k]=cellvalue.data;
			}
		}
	}
	let x;
	do {
		x = updateConstraints16(input);
	} while(x > 0);
	search_dfs16();
}
function search_dfs16()	{
	console.log("Using dfs for 16");
	reorder_constraints16();
	initialize_dfs16();
	search_r16();
}
function reorder_constraints16()	{
	let fewest_constraints = 18;
	let fewest = -1;
	cOrder16.length = 0;

	/* find a cell with the fewest constraints */
	for(let p = 0; p < 256; p++)
		if(constraints16[p][0] > 1 && constraints16[p][0] < fewest_constraints)	{
			fewest = p;
			fewest_constraints = constraints16[p][0];
		}
	if(fewest == -1)
		return;
	cOrder16.push(fewest);
	
	/* add all constraints along fewest's row and column and block */
	let r = Math.floor(fewest / 16);
	let c = fewest % 16;
	let b = Math.floor(r/4)*4 + Math.floor(c/4);
	for(let x = 0; x < 16; x++)
		if(x*16+c != fewest && constraints16[x*16+c][0] > 1)
			cOrder16.push(x*16+c);
	for(let x = 0; x < 16; x++)
		if(r*16+x != fewest && constraints16[r*16+x][0] > 1)
			cOrder16.push(r*16+x);
	for(let x = 0; x < 16; x++)	{
		let r_2 = Math.floor(blockDef16[b][x]/16);
		let c_2 = blockDef16[b][x] % 16;
		if(r_2 == r || c_2 == c || constraints16[blockDef16[b][x]][0] < 3)
			continue;
		cOrder16.push(blockDef16[b][x]);	
	}
	
	/* add all the remaining constraints */
	for(let x = 0; x < 256; x++)	{
		if(constraints16[x][0] < 3)
			continue;
		let r_2 = Math.floor(x/ 16);
		let c_2 = x% 16;
		let b_2 = Math.floor(r_2/4)*4 + Math.floor(c_2/4);
		if(r_2 == r || c_2 == c || b_2 == b)
			continue;
		cOrder16.push(x);	
	}
}
function initialize_dfs16()	{
	for(let x = 0; x < 256; x++)
		cpointers16[x] = 0;
	search_pos = 0;
}
function search_r16()	{
  	let iter = 0;
	let body = document.getElementById("right");
	let tbl = body.getElementsByTagName("table")[0];
	
  	while(iter++ < iters_per_timeslice)	{
  		
  		if(search_pos >= cOrder16.length)	{
  			/* Solved */
		  	for(let p = 0; p < cOrder16.length; p++)	{
		  		let cons = cOrder16[p];
		  		let r = Math.floor(cons/16);
		  		let c = cons%16;
		  		tbl.rows[r].cells[c].innerHTML = cpointers16[cons];
		  	}
  			return;
  		}
  	
		let cons = cOrder16[search_pos];
		
		/* find an allowable number for this cell */
		while(++cpointers16[cons] < 17)	
			if(constraints16[cons][cpointers16[cons]] == 1 && validate16())	
				break;
			
		if(cpointers16[cons] >= 17)	{
			cpointers16[cons] = 0;
			search_pos--;
			continue;
		} 
		
		search_pos++;  
  	}  
  	
  	/* display progress */
  	for(let p = 0; p < cOrder16.length; p++)	{
  		let cons = cOrder16[p];
  		let r = Math.floor(cons/16);
  		let c = cons%16;
  		tbl.rows[r].cells[c].innerHTML = p<search_pos?cpointers16[cons]:" ";
  	}
	if(randomize && timeslices % 50 == 0)
		randomize_constraints_from(search_pos);
  	
  	timeslices++;
  	console.log("Phase 2: Search.<br><b>Timeslices:</b> "+timeslices);
  	setTimeout("search_r16()", sleep_timeslice);
	
}

function updateConstraints16(pos)	{
	let body = document.getElementById("right");
	let tbl = body.getElementsByTagName("table")[0];
//	console.log(pos);
	let solved = 0;
	let sum = 0;
	let num = 0;

	for(let p = 0; p < 256; p++)	{
		for(let x = 0; x < 17; x++)
			constraints16[p][x] = 0;
			
		if(pos[p] >= 1 && pos[p] <= 16)	{
		  	/* filled cell, no constraints16 */
			constraints16[p][0] = 1;
			constraints16[p][pos[p]] = 1;
		}
		else	{
			/* blank square, find possible values */
			let r = Math.floor(p / 16);
			let c = p % 16;
			for(let x = 1; x <= 16; x++)
				constraints16[p][x] = 1;
			/* get row constraints16 */
			for(let x = 0; x < 16; x++)
				if(pos[r * 16 + x] > 0)
					constraints16[p][Number(pos[r*16+x])] = 0;
			/* get column constraints16 */
			for(let x = 0; x < 16; x++)
				if(pos[x * 16 + c] > 0)
					constraints16[p][Number(pos[x*16+c])] = 0;
			/* get block constraints16 */
			let block = Math.floor(r/4)*4 + Math.floor(c/4);
			for(let x = 0; x < 16; x++)
			  if(pos[blockDef16[block][x]] > 0)
			    constraints16[p][Number(pos[blockDef16[block][x]])] = 0;
			
			/* update constraints16 */
			let last_valid = -1;
			for(let x = 1; x <= 16; x++)
				if(constraints16[p][x] == 1) 	{
					constraints16[p][0]++;
					last_valid = x;
				}
				
			if(constraints16[p][0] == 1)	{
			  	pos[p] = last_valid;
				tbl.rows[r].cells[c].innerHTML=pos[p];
				solved++;
			}
			
		}

		if(constraints16[p][0] > 0)	{		
			sum += constraints16[p][0];
			num++;
		}
	}		
	
	return solved;
}
function validate16()	{
	let x = cOrder16[search_pos];
	let cur_r = Math.floor(x/16);
	let cur_c = x%16;
	let cur_b = Math.floor(cur_r/4)*4 + Math.floor(cur_c/4);

	for(let m = 0; m < search_pos; m++)	{
		let p = cOrder16[m];
		let r = Math.floor(p / 16);
		let c = p % 16;
		let b = Math.floor(r/4)*4 + Math.floor(c/4);
		if( (r == cur_r || c == cur_c || b == cur_b) && cpointers16[p] == cpointers16[x])	
			return false;	
	}
	return true;
}
function solution(){
	let count=document.getElementById('grid').value;
	if (count == 4)
		solvingfour();
	if (count == 9)
		solvingnine();
	if (count == 16)
		solving16();
}
</script>

</body>
</html>